
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <title>7. Logging &#8212; rootpy 1.0.0.dev0 documentation</title>

<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"/>


    <link rel="stylesheet" href="../_static/rtd.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0.dev0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/searchtools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="8. Contributing" href="../contributing.html" />
    <link rel="prev" title="6. Files" href="files.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../contributing.html" title="8. Contributing"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="files.html" title="6. Files"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">rootpy 1.0.0.dev0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="logging">
<span id="id1"></span><h1>7. Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h1>
<p>More detail about ways to use logging can be found in the rootpy logger module,
see <a class="reference internal" href="../reference/logger.html#module-rootpy.logger" title="rootpy.logger"><code class="xref py py-mod docutils literal"><span class="pre">rootpy.logger</span></code></a>.</p>
<div class="section" id="python-logging-basics">
<h2>7.1. Python logging basics<a class="headerlink" href="#python-logging-basics" title="Permalink to this headline">¶</a></h2>
<p>In Python’s standard library there is a <code class="docutils literal"><span class="pre">logging</span></code> module. It’s good to make
use of this, because it means that you can interoperate with a large range of
tools which already use it. <code class="xref py py-mod docutils literal"><span class="pre">rootpy</span></code> extends the default logger to add
a range of useful utilities, but underlying it is the normal logging behaviour.</p>
<p>Python’s <code class="docutils literal"><span class="pre">logging</span></code> module allows you to define a hierarchy of loggers.
Confusingly, the base of the hierarchy is called <code class="docutils literal"><span class="pre">root</span></code>. Each logger in a
hierarchy has a <code class="docutils literal"><span class="pre">.level</span></code> (one of <code class="docutils literal"><span class="pre">CRITICAL</span></code>, <code class="docutils literal"><span class="pre">ERROR</span></code>, <code class="docutils literal"><span class="pre">WARNING</span></code>,
<code class="docutils literal"><span class="pre">INFO</span></code>, <code class="docutils literal"><span class="pre">DEBUG</span></code>, <code class="docutils literal"><span class="pre">NOTSET</span></code>), which defines the minimum severity of messages
which will be passed onto the handlers.</p>
<p>Handlers can be attached to specific loggers, or anywhere in the hierarchy. For
example, a handler attached to the logger <code class="docutils literal"><span class="pre">logging.root</span></code> would recieve all
messages which meet the <code class="docutils literal"><span class="pre">root</span></code> logger’s minimum level.</p>
<p>Handlers have a <code class="docutils literal"><span class="pre">level</span></code>, independently of a logger. This means that a handler
can be configured to only receive certain messages.</p>
<p>By default, Python configures no handlers. This means that ordinarily, after
emitting a brief one-time warning about no handlers being configured, messages
get sent into the void, never to be heard from again. In addition, the default
state of the <code class="docutils literal"><span class="pre">logging.root</span></code> logger is <code class="docutils literal"><span class="pre">WARNING</span></code>, so at first, no messages
less severe than that (<code class="docutils literal"><span class="pre">INFO</span></code> and <code class="docutils literal"><span class="pre">DEBUG</span></code>) will be processed.</p>
<p>This makes it reasonable to leave <code class="docutils literal"><span class="pre">log.debug</span></code> statements in non-performance
critical code, since by default they aren’t shown.</p>
</div>
<div class="section" id="capturing-root-messages-with-rootpy-logger">
<h2>7.2. Capturing ROOT messages with <a class="reference internal" href="../reference/logger.html#module-rootpy.logger" title="rootpy.logger"><code class="xref py py-mod docutils literal"><span class="pre">rootpy.logger</span></code></a><a class="headerlink" href="#capturing-root-messages-with-rootpy-logger" title="Permalink to this headline">¶</a></h2>
<p>rootpy provides a mechanism to capture ROOT’s log messages and if appropriate,
raise an error. This can be a big boon for debugging and makes it possible to
do things which were not previously possible, such as capture messages to show
them where they are needed (think of web services, for example).</p>
<p>As a trivial example, it means that this:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [2]: </span><span class="n">r</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="s2">&quot;test.root&quot;</span><span class="p">)</span>
<span class="go">Error in &lt;TFile::TFile&gt;: file test.root does not exist</span>

<span class="gp">In [3]: </span><span class="n">r</span><span class="o">.</span><span class="n">myanalysisdata</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">AttributeError                            Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-3-c06f1156de1b&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 r.myanalysisdata</span>

<span class="go">AttributeError: TFile object has no attribute &#39;myanalysisdata&#39;</span>
</pre></div>
</div>
<p>Now does this:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [3]: </span><span class="kn">import</span> <span class="nn">rootpy</span>
<span class="gp">In [4]: </span><span class="n">f</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="s2">&quot;test.root&quot;</span><span class="p">)</span>
<span class="go">&gt; Warning: No logger for &#39;ROOT&#39;, adding a default</span>
<span class="go">&gt;          Suppress with &#39;import logging; logging.basicConfig()&#39;</span>
<span class="go">ERROR:ROOT.TFile.TFile:file test.root does not exist</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">ROOTError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-4-e2c494f4c26e&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 f = ROOT.TFile(&quot;test.root&quot;)</span>

<span class="go">&lt;ipython-input-4-e2c494f4c26e&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 f = ROOT.TFile(&quot;test.root&quot;)</span>

<span class="go">.../rootpy/logger/roothandler.py in python_logging_error_handler(level, abort, location, msg)</span>
<span class="go">      50                         # We can&#39;t raise an exception from here because ctypes/PyROOT swallows it.</span>
<span class="go">      51                         # Hence the need for dark magic, we re-raise it within a trace.</span>
<span class="go">---&gt; 52                         raise ROOTError(level, location, msg)</span>
<span class="go">      53                 except RuntimeError:</span>
<span class="go">      54                         _, exc, traceback = sys.exc_info()</span>

<span class="go">ROOTError: level=3000, loc=&#39;TFile::TFile&#39;, msg=&#39;file test.root does not exist&#39;</span>
</pre></div>
</div>
<p>This means that the code fails early, even better it’s at the point of the
problem. It uses python’s logging mechanism, so now it’s possible to filter
messages with ease.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The astute amongst you might have noticed a passing mention of dark magic. This
feature is still a little experimental, and is currently limited to CPython 2.6-2.7.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If errors don’t give you backtraces as you expect, it might be necessary to:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rootpy.logger.magic</span> <span class="kn">as</span> <span class="nn">M</span><span class="p">;</span> <span class="n">M</span><span class="o">.</span><span class="n">DANGER</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
</div>
<p>The first thing to note is the warning mentioning a lack of a default logger. To
suppress this, configure logging any way you please, or use the snippet from the
warning itself.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="c1"># Most verbose log level</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</pre></div>
</div>
<p>Once that is done, you can use python’s normal logging API to suppress or
highlight log messages coming from particular places with ease:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="c1"># Suppress &quot;debug&quot;-level notices from TCanvas that it has saved a .png</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;ROOT.TCanvas&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want to get the stack trace at the point where any ROOT message is coming
from, you can decrease the abort level to the minimum:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ROOT</span>
<span class="n">ROOT</span><span class="o">.</span><span class="n">gErrorAbortLevel</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="what-else-does-rootpy-s-logging-do-for-me">
<h2>7.3. What else does rootpy’s logging do for me?<a class="headerlink" href="#what-else-does-rootpy-s-logging-do-for-me" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../reference/logger.html#module-rootpy.logger" title="rootpy.logger"><code class="xref py py-mod docutils literal"><span class="pre">rootpy.logger</span></code></a> adds a check to ensure that a handler is configured
against the <code class="docutils literal"><span class="pre">rootpy</span></code> logging namespace and, if not, installs a default one.</p>
<p>There is some syntactic sugar to obtain loggers in a given namespace:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rootpy</span>

<span class="c1"># logger in the rootpy logging namespace</span>
<span class="c1"># (whose parent is python&#39;s `logging.root`)</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">rootpy</span><span class="o">.</span><span class="n">log</span>

<span class="n">log</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]</span> <span class="c1"># logger in the rootpy.child namespace</span>
<span class="n">log</span><span class="p">[</span><span class="s2">&quot;/ROOT&quot;</span><span class="p">]</span> <span class="c1"># ROOT</span>
<span class="n">log</span><span class="p">[</span><span class="s2">&quot;/ROOT.TFile&quot;</span><span class="p">]</span> <span class="c1"># ROOT.TFile</span>
</pre></div>
</div>
<p><a class="reference internal" href="../reference/logger.html#module-rootpy.logger" title="rootpy.logger"><code class="xref py py-mod docutils literal"><span class="pre">rootpy.logger</span></code></a> can also help you identify <em>where</em> messages are coming
from, using <code class="xref py py-meth docutils literal"><span class="pre">rootpy.logger.extended_logger.ExtendedLogger.show_stack()</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">log</span><span class="p">[</span><span class="s2">&quot;/&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">NOTSET</span><span class="p">)</span>
<span class="c1"># Show stack traces for</span>
<span class="n">log</span><span class="p">[</span><span class="s2">&quot;/ROOT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">show_stack</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/rootpy-logo-80dpi.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">7. Logging</a><ul>
<li><a class="reference internal" href="#python-logging-basics">7.1. Python logging basics</a></li>
<li><a class="reference internal" href="#capturing-root-messages-with-rootpy-logger">7.2. Capturing ROOT messages with <code class="docutils literal"><span class="pre">rootpy.logger</span></code></a></li>
<li><a class="reference internal" href="#what-else-does-rootpy-s-logging-do-for-me">7.3. What else does rootpy’s logging do for me?</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="files.html"
                        title="previous chapter">6. Files</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../contributing.html"
                        title="next chapter">8. Contributing</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../contributing.html" title="8. Contributing"
             >next</a> |</li>
        <li class="right" >
          <a href="files.html" title="6. Files"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">rootpy 1.0.0.dev0 documentation</a> &#187;</li> 
      </ul>
    </div>
<div class="footer">
    &copy; Copyright 2017, rootpy developers.
</div>



<!-- Google Analytics Code -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-39364267-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  </body>
</html>